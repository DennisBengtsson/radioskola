<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Statistik - Radioskola.se</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-container">
            <a href="../../index.html" class="logo">
                <span class="logo-icon">üìª</span>
                <span>Radioskola.se</span>
            </a>
            <ul class="nav-links">
                <li><a href="../../index.html">Hem</a></li>
                <li><a href="../../index.html#studera">Studera</a></li>
                <li><a href="../test/prov.html">G√∂r prov</a></li>
                <li><a href="../pdf/index.html">PDF-b√∂cker</a></li>
                <li><a href="../profil/statistik.html" class="active">Min statistik</a></li>
            </ul>
        </div>
    </nav>

    <main class="stats-page">
        <div class="stats-container">
            <header class="stats-header">
                <h1>üìä Min Statistik</h1>
                <p>F√∂lj din progress och se var du kan f√∂rb√§ttras</p>
            </header>

            <!-- TOTALER -->
            <section class="stats-section">
                <h2 class="collapsible-header" onclick="toggleSection(this)">
                    Totalt <span class="collapse-icon">‚ñæ</span>
                </h2>
                <div class="collapsible-body">
                    <div class="stats-grid" id="statsGrid"></div>
                </div>
            </section>

            <!-- √ñVNINGAR (delkapitel) -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    üìù √ñvningar <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <p class="section-desc">Delkapitels√∂vningar p√• <a href="../test/ovning.html">√∂vningssidan</a>. Kr√§ver 80% f√∂r godk√§nt.</p>
                    <div id="subchapterStats"></div>
                </div>
            </section>

            <!-- CERTIFIKATSPROV (slutprov) -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    üéì Certifikatsprov <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <p class="section-desc">Simulerade slutprov. Kr√§ver 70% f√∂r godk√§nt.</p>
                    <div id="certExamStats"></div>
                    <div id="certExamHistory"></div>
                </div>
            </section>

            <!-- PROVREDO-STATUS -->
            <section class="stats-section" id="examReadiness"></section>

            <!-- KUNSKAPSNIV√Ö PER KAPITEL -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    Kunskapsniv√• per Kapitel <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <p class="section-desc">Baserat p√• √∂vningsprov per kapitel.</p>
                    <div id="knowledgeChart"></div>
                </div>
            </section>

            <!-- SVAGA OMR√ÖDEN -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    Omr√•den att F√∂rb√§ttra <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <div id="weakAreas"></div>
                </div>
            </section>

            <!-- UTM√ÑRKELSER -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    üèÜ Utm√§rkelser <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>
            </section>

            <!-- DATAHANTERING -->
            <section class="stats-section">
                <h2 class="collapsible-header collapsed" onclick="toggleSection(this)">
                    ‚öôÔ∏è Datahantering <span class="collapse-icon">‚ñ∏</span>
                </h2>
                <div class="collapsible-body" style="display:none">
                    <div class="data-actions">
                        <button class="btn btn-secondary" onclick="ProgressManager.exportData()">üì• Exportera Data</button>
                        <label class="btn btn-secondary">
                            üì§ Importera Data
                            <input type="file" accept=".json" onchange="ProgressManager.importData(this.files[0])" style="display:none">
                        </label>
                        <button class="btn btn-danger" onclick="ProgressManager.resetAllData()">üóëÔ∏è Radera All Data</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="../../js/data/cert-chapters.js"></script>
    <script src="../../js/data/questions.js"></script>
    <script src="../../js/progress.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        renderStatistics();
    });

    function renderStatistics() {
        renderStatsOverview();
        renderSubchapterStats();

        renderCertExamStats();
        renderExamReadiness();
        renderKnowledgeChart();
        renderWeakAreas();
        renderAchievements();
    }

    // ============================================
    // TOTALER
    // ============================================
    function renderStatsOverview() {
        const stats = ProgressManager.getOverallStats();
        const container = document.getElementById('statsGrid');

        container.innerHTML = `
            <div class="stats-card">
                <div class="stats-card-icon">üìù</div>
                <div class="stats-card-content">
                    <div class="big-number">${stats.totalQuestionsAnswered}</div>
                    <div class="stats-card-label">Fr√•gor besvarade (totalt)</div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-card-icon">‚úÖ</div>
                <div class="stats-card-content">
                    <div class="big-number">${stats.totalCorrect}</div>
                    <div class="stats-card-label">R√§tta svar (totalt)</div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-card-icon">üéØ</div>
                <div class="stats-card-content">
                    <div class="big-number">${stats.averageScore}%</div>
                    <div class="stats-card-label">Genomsnitt (totalt)</div>
                </div>
            </div>
        `;
    }

    // ============================================
    // √ñVNINGAR (delkapitel)
    // ============================================
    function renderSubchapterStats() {
        const stats = ProgressManager.getOverallStats();
        const container = document.getElementById('subchapterStats');
        const sub = stats.subchapters;

        if (sub.total === 0) {
            container.innerHTML = emptyState('Inga √∂vningar gjorda √§nnu', 'G√• till <a href="../test/ovning.html">√∂vningssidan</a> f√∂r att b√∂rja!');
            return;
        }

        // Samla delkapiteldata per kapitel
        const data = ProgressManager.getData();
        let chapterRows = '';

        if (typeof certChapters !== 'undefined') {
            certChapters.forEach(chapter => {
                if (!chapter.subchapters || chapter.subchapters.length === 0) return;

                const totalSubs = chapter.subchapters.filter(s => s.exercises && s.exercises.length > 0).length;
                if (totalSubs === 0) return;

                const completedSubs = chapter.subchapters.filter(s => {
                    const key = `${chapter.id}-${s.id}`;
                    return data.subchaptersProgress[key] && data.subchaptersProgress[key].completed;
                }).length;

                const pct = totalSubs > 0 ? Math.round((completedSubs / totalSubs) * 100) : 0;
                const barClass = pct >= 80 ? 'high' : pct >= 40 ? 'medium' : 'low';

                chapterRows += `
                    <div class="knowledge-row">
                        <div class="knowledge-info">
                            <span class="knowledge-chapter-name">${chapter.icon} ${chapter.title}</span>
                            <span class="knowledge-questions">${completedSubs}/${totalSubs} delkapitel klara</span>
                        </div>
                        <div class="knowledge-bar-container">
                            <div class="progress-bar large">
                                <div class="progress-fill ${barClass}" style="width:${pct}%"></div>
                            </div>
                            <span class="knowledge-percent">${pct}%</span>
                        </div>
                        <a href="../test/ovning.html?chapter=${chapter.id}" class="btn btn-small btn-secondary">√ñva</a>
                    </div>
                `;
            });
        }

        container.innerHTML = `
            <div class="mini-stats-row">
                <div class="mini-stat">
                    <span class="mini-stat-num">${sub.completed}</span>
                    <span class="mini-stat-label">Klarade delkapitel</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-num">${sub.total}</span>
                    <span class="mini-stat-label">P√•b√∂rjade delkapitel</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-num">${sub.completionRate}%</span>
                    <span class="mini-stat-label">Klarat (av p√•b√∂rjade)</span>
                </div>
            </div>
            ${chapterRows ? `<div class="knowledge-chart">${chapterRows}</div>` : ''}
        `;
    }



    // ============================================
    // CERTIFIKATSPROV (slutprov)
    // ============================================
    function renderCertExamStats() {
        const stats = ProgressManager.getOverallStats();
        const data = ProgressManager.getData();
        const container = document.getElementById('certExamStats');
        const histContainer = document.getElementById('certExamHistory');
        const ce = stats.certExams;

        if (ce.total === 0) {
            container.innerHTML = emptyState('Inga certifikatsprov gjorda √§nnu', 'G√∂r ditt f√∂rsta simulerade slutprov f√∂r att se statistik h√§r.');
            histContainer.innerHTML = '';
            return;
        }

        let trendHtml = '';
        if (ce.trend !== 0) {
            const dir = ce.trend > 0 ? 'up' : 'down';
            const arrow = ce.trend > 0 ? '‚Üë' : '‚Üì';
            trendHtml = `<div class="trend ${dir}">${arrow} ${Math.abs(ce.trend)}% senaste proven</div>`;
        }

        container.innerHTML = `
            <div class="mini-stats-row">
                <div class="mini-stat">
                    <span class="mini-stat-num">${ce.total}</span>
                    <span class="mini-stat-label">Genomf√∂rda prov</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-num">${ce.passed}</span>
                    <span class="mini-stat-label">Godk√§nda (‚â•70%)</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-num">${ce.passRate}%</span>
                    <span class="mini-stat-label">Godk√§nnandegrad</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-num">${ce.recentAverage}%</span>
                    <span class="mini-stat-label">Snitt (senaste 5)${trendHtml}</span>
                </div>
            </div>
        `;

        // Historik
        const rows = data.certExamHistory.slice(0, 10).map(exam => {
            const date = new Date(exam.date);
            const dateStr = date.toLocaleDateString('sv-SE');
            const timeStr = date.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit' });
            const duration = exam.timeSpent
                ? `${Math.floor(exam.timeSpent / 60)}:${(exam.timeSpent % 60).toString().padStart(2, '0')}`
                : '‚Äì';

            return `
                <div class="history-item ${exam.passed ? 'passed' : 'failed'}">
                    <div class="history-date">
                        <div class="history-date-main">${dateStr}</div>
                        <div class="history-date-time">${timeStr}</div>
                    </div>
                    <div class="history-info">
                        <span class="history-type">Certifikatsprov</span>
                        <span class="history-details">${exam.correctAnswers}/${exam.totalQuestions} r√§tt ‚Ä¢ ${duration} min</span>
                    </div>
                    <div class="history-score ${exam.passed ? 'passed' : 'failed'}">${exam.percentage}%</div>
                </div>
            `;
        }).join('');

        histContainer.innerHTML = `<h4 style="margin:1rem 0 0.5rem">Historik (senaste 10)</h4><div class="history-list">${rows}</div>`;
    }

    // ============================================
    // PROVREDO-STATUS
    // ============================================
    function renderExamReadiness() {
        const stats = ProgressManager.getOverallStats();
        const container = document.getElementById('examReadiness');
        const ce = stats.certExams;

        let level, message, cls, btnText, btnHref;

        if (stats.isExamReady) {
            level = 'Redo f√∂r prov! üéâ';
            message = 'Du har visat konsekvent goda resultat p√• certifikatsprovet. Du √§r redo att ta det riktiga provet hos PTS!';
            cls = 'ready';
            btnText = 'Hitta provf√∂rr√§ttare (SSA)';
            btnHref = 'https://www.ssa.se/ssa/funktionarer/provforrattare/';
        } else if (ce.recentAverage >= 60) {
            level = 'N√§stan d√§r! üí™';
            message = 'Du √§r p√• god v√§g! Forts√§tt √∂va certifikatsprovet f√∂r att n√• 75% i snitt.';
            cls = 'almost';
            btnText = 'G√∂r ett certifikatsprov';
            btnHref = '../test/prov.html';
        } else if (ce.total > 0) {
            level = 'Forts√§tt √∂va üìö';
            message = 'Fokusera p√• dina svaga kapitel och g√∂r fler certifikatsprov.';
            cls = 'needs-work';
            btnText = 'G√∂r ett certifikatsprov';
            btnHref = '../test/prov.html';
        } else {
            level = 'B√∂rja din resa üöÄ';
            message = 'G√∂r n√•gra certifikatsprov f√∂r att se var du st√•r!';
            cls = 'new';
            btnText = 'Starta certifikatsprov';
            btnHref = '../test/prov.html';
        }

        const fillPct = Math.min(Math.round(ce.recentAverage / 75 * 100), 100);

        container.innerHTML = `
            <h2>Provredo-status</h2>
            <div class="readiness-card ${cls}">
                <div class="readiness-content">
                    <h3>${level}</h3>
                    <p>${message}</p>
                    <div class="readiness-meter">
                        <div class="readiness-bar">
                            <div class="readiness-fill" style="width:${fillPct}%"></div>
                        </div>
                        <span class="readiness-target">M√•l: 75%</span>
                    </div>
                </div>
                <a href="${btnHref}" ${btnHref.startsWith('http') ? 'target="_blank" rel="noopener noreferrer"' : ''} class="btn ${stats.isExamReady ? 'btn-success' : 'btn-primary'}">
                    ${btnText}
                </a>
            </div>
        `;
    }

    // ============================================
    // KUNSKAPSNIV√Ö PER KAPITEL (√∂vningsprov)
    // ============================================
    function renderKnowledgeChart() {
        const container = document.getElementById('knowledgeChart');

        if (typeof certChapters === 'undefined') {
            container.innerHTML = '<p>Kapiteldata saknas.</p>';
            return;
        }

        const rows = certChapters.map(chapter => {
            const progress = ProgressManager.getChapterProgress(chapter.id);
            const score = progress.bestScore || 0;
            const attempts = progress.attempts || 0;
            const barClass = score >= 80 ? 'high' : score >= 50 ? 'medium' : 'low';

            return `
                <div class="knowledge-row">
                    <div class="knowledge-info">
                        <span class="knowledge-chapter-name">${chapter.icon} ${chapter.title}</span>
                        <span class="knowledge-questions">${attempts} √∂vningsprov gjorda</span>
                    </div>
                    <div class="knowledge-bar-container">
                        <div class="progress-bar large">
                            <div class="progress-fill ${barClass}" style="width:${score}%"></div>
                        </div>
                        <span class="knowledge-percent">${score > 0 ? score + '%' : '‚Äì'}</span>
                    </div>
                    <a href="../test/ovning.html?chapter=${chapter.id}" class="btn btn-small btn-secondary">√ñva</a>
                </div>
            `;
        }).join('');

        container.innerHTML = `<div class="knowledge-chart">${rows}</div>`;
    }

    // ============================================
    // SVAGA OMR√ÖDEN
    // ============================================
    function renderWeakAreas() {
        const weakChapters = ProgressManager.getWeakestChapters(3);
        const container = document.getElementById('weakAreas');

        if (weakChapters.length === 0) {
            container.innerHTML = emptyState('', 'G√∂r fler √∂vningsprov f√∂r att se vilka kapitel du beh√∂ver f√∂rb√§ttra!');
            return;
        }

        const chapterMap = {};
        if (typeof certChapters !== 'undefined') {
            certChapters.forEach(c => { chapterMap[c.id] = c; });
        }

        const items = weakChapters.map(w => {
            const chapter = chapterMap[w.chapterId];
            const name = chapter ? `${chapter.icon} ${chapter.title}` : `Kapitel ${w.chapterId}`;
            return `
                <a href="../test/ovning.html?chapter=${w.chapterId}" class="weak-item">
                    <span class="weak-item-name">${name}</span>
                    <span class="weak-item-score">${w.score}%</span>
                    <span class="weak-item-action">√ñva ‚Üí</span>
                </a>
            `;
        }).join('');

        container.innerHTML = `
            <h4>Svagaste kapitel (√∂vningsprov)</h4>
            <div class="weak-items">${items}</div>
        `;
    }

    // ============================================
    // UTM√ÑRKELSER
    // ============================================
    function renderAchievements() {
        const data = ProgressManager.getData();
        const container = document.getElementById('achievementsGrid');

        const allAchievements = [
            { id: 'first_question',       name: 'F√∂rsta Steget',      description: 'Svara p√• din f√∂rsta fr√•ga',                icon: 'üéØ' },
            { id: 'ten_correct',          name: 'Bra Start',          description: 'Svara r√§tt p√• 10 fr√•gor',                  icon: '‚≠ê' },
            { id: 'hundred_questions',    name: 'Dedikerad Student',  description: 'Svara p√• 100 fr√•gor',                      icon: 'üìö' },
            { id: 'first_subchapter',     name: 'Delkapitel Klarat',  description: 'Klara ett delkapitel med 80%',              icon: '‚úÖ' },
            { id: 'first_practice_exam',  name: '√ñvningsprov',        description: 'Genomf√∂r ditt f√∂rsta √∂vningsprov',          icon: 'üìã' },
            { id: 'first_cert_exam',      name: 'Slutprov',           description: 'Genomf√∂r ditt f√∂rsta certifikatsprov',      icon: 'üìù' },
            { id: 'first_cert_pass',      name: 'Godk√§nd!',           description: 'Klara ett certifikatsprov med minst 70%',   icon: 'üéì' },
            { id: 'perfect_exam',         name: 'Perfektionist',      description: 'F√• 100% p√• ett certifikatsprov',            icon: 'üèÜ' },
            { id: 'five_passed',          name: 'Konsekvent',          description: 'Klara 5 certifikatsprov i rad',             icon: 'üî•' },
            { id: 'all_chapters_practiced', name: 'Allround',         description: 'G√∂r √∂vningsprov p√• alla 10 kapitel',        icon: 'üåü' },
            { id: 'speed_demon',          name: 'Snabbt√§nkt',         description: 'Klara ett certifikatsprov p√• under 30 min', icon: '‚ö°' },
            { id: 'veteran',              name: 'Veteran',             description: 'Svara p√• 500 fr√•gor',                      icon: 'üèÖ' },
            { id: 'exam_ready',           name: 'Provredo',           description: 'N√• provredo-status',                       icon: 'üéñÔ∏è' }
        ];

        container.innerHTML = allAchievements.map(a => {
            const unlocked = data.achievements && data.achievements.includes(a.id);
            return `
                <div class="achievement-card ${unlocked ? 'unlocked' : 'locked'}">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${a.name}</div>
                        <div class="achievement-desc">${a.description}</div>
                    </div>
                    ${unlocked ? '<div class="achievement-check">‚úì</div>' : '<div class="achievement-lock">üîí</div>'}
                </div>
            `;
        }).join('');
    }

    // ============================================
    // KOLLAPS-FUNKTION
    // ============================================
    function toggleSection(header) {
        const body = header.nextElementSibling;
        const icon = header.querySelector('.collapse-icon');
        const isOpen = !header.classList.contains('collapsed');

        if (isOpen) {
            body.style.display = 'none';
            header.classList.add('collapsed');
            icon.textContent = '‚ñ∏';
        } else {
            body.style.display = 'block';
            header.classList.remove('collapsed');
            icon.textContent = '‚ñæ';
        }
    }

    // ============================================
    // HJ√ÑLPFUNKTION
    // ============================================
    function emptyState(title, message) {
        return `
            <div class="empty-state small">
                ${title ? `<h3>${title}</h3>` : ''}
                <p>${message}</p>
            </div>
        `;
    }
    </script>

    <style>
        .stats-page {
            background: var(--background);
            min-height: calc(100vh - 80px);
            padding: 2rem;
        }

        .stats-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .stats-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .stats-header p { color: var(--text-secondary); }

        /* Sections */
        .stats-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .stats-section h2 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            margin-bottom: 0 !important;
        }

        .collapsible-header:hover { color: var(--primary-color); }

        .collapsible-header.collapsed {
            border-bottom: none;
            padding-bottom: 0;
        }

        .collapse-icon {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .collapsible-body { margin-top: 1rem; }

        .section-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        /* Totaler */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .stats-card {
            background: var(--background);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stats-card-icon { font-size: 2rem; }

        .big-number {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stats-card-label { color: var(--text-secondary); font-size: 0.8rem; }

        /* Mini stats */
        .mini-stats-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .mini-stat {
            background: var(--background);
            border-radius: var(--radius-md);
            padding: 1rem 1.25rem;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }

        .mini-stat-num {
            display: block;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .mini-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Knowledge rows */
        .knowledge-chart { margin-top: 0.5rem; }

        .knowledge-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .knowledge-row:last-child { border-bottom: none; }

        .knowledge-info { width: 200px; }

        .knowledge-chapter-name { display: block; font-weight: 500; font-size: 0.9rem; }

        .knowledge-questions { font-size: 0.75rem; color: var(--text-secondary); }

        .knowledge-bar-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar.large { height: 12px; }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-fill.low    { background: linear-gradient(90deg, #ef4444, #f87171); }
        .progress-fill.medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-fill.high   { background: linear-gradient(90deg, #10b981, #34d399); }

        .knowledge-percent { width: 45px; text-align: right; font-weight: 600; font-size: 0.875rem; }

        /* History */
        .history-list { margin-top: 0.5rem; }

        .history-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            gap: 1rem;
        }

        .history-item:last-child { border-bottom: none; }

        .history-date { text-align: center; min-width: 80px; }
        .history-date-main { font-weight: 500; font-size: 0.875rem; }
        .history-date-time { font-size: 0.75rem; color: var(--text-secondary); }

        .history-info { flex: 1; }
        .history-type { display: block; font-weight: 500; font-size: 0.9rem; }
        .history-details { font-size: 0.8rem; color: var(--text-secondary); }

        .history-score { font-size: 1.25rem; font-weight: 700; min-width: 55px; text-align: right; }
        .history-score.passed { color: var(--success-color, #10b981); }
        .history-score.failed { color: var(--danger-color, #ef4444); }

        /* Readiness */
        .readiness-card {
            background: var(--background);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--border-color);
            gap: 1rem;
        }

        .readiness-card.ready      { border-left-color: #10b981; }
        .readiness-card.almost     { border-left-color: #f59e0b; }
        .readiness-card.needs-work { border-left-color: #ef4444; }
        .readiness-card.new        { border-left-color: var(--primary-color); }

        .readiness-content h3 { margin-bottom: 0.5rem; }
        .readiness-content p  { color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem; }

        .readiness-meter { display: flex; align-items: center; gap: 1rem; }

        .readiness-bar {
            width: 180px;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .readiness-fill {
            height: 100%;
            background: var(--primary-color);
            border-radius: 4px;
            transition: width 0.5s;
        }

        .readiness-target { font-size: 0.75rem; color: var(--text-secondary); }

        /* Trend */
        .trend { font-size: 0.75rem; margin-top: 0.25rem; }
        .trend.up   { color: #10b981; }
        .trend.down { color: #ef4444; }

        /* Weak areas */
        .weak-items { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.75rem; }

        .weak-item {
            display: flex;
            align-items: center;
            padding: 0.875rem 1rem;
            background: var(--background);
            border-radius: var(--radius-md);
            text-decoration: none;
            color: inherit;
            transition: background 0.2s;
        }

        .weak-item:hover { background: var(--border-color); }
        .weak-item-name  { flex: 1; font-weight: 500; }
        .weak-item-score { color: #ef4444; font-weight: 600; margin-right: 1rem; }
        .weak-item-action { color: var(--primary-color); }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 0.75rem;
        }

        .achievement-card {
            display: flex;
            align-items: center;
            padding: 0.875rem;
            background: var(--background);
            border-radius: var(--radius-md);
            gap: 0.75rem;
        }

        .achievement-card.locked  { opacity: 0.45; }
        .achievement-card.unlocked {
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid #10b981;
        }

        .achievement-icon  { font-size: 1.75rem; }
        .achievement-info  { flex: 1; }
        .achievement-name  { font-weight: 600; font-size: 0.9rem; }
        .achievement-desc  { font-size: 0.75rem; color: var(--text-secondary); }
        .achievement-check { color: #10b981; font-size: 1.1rem; }
        .achievement-lock  { font-size: 1.1rem; }

        /* Data management */
        .data-actions { display: flex; gap: 1rem; flex-wrap: wrap; }

        /* Empty state */
        .empty-state { padding: 1.5rem; color: var(--text-secondary); }
        .empty-state h3 { margin-bottom: 0.5rem; }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-page { padding: 1rem; }
            .readiness-card { flex-direction: column; }
            .knowledge-info { width: 100%; }
            .knowledge-row { flex-wrap: wrap; }
            .data-actions { flex-direction: column; }
            .data-actions .btn { width: 100%; }
        }
    </style>
</body>
</html>
